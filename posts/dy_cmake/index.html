<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>自分でやるDyのCMakeListsファイル説明 | neuromantic</title><meta name=keywords content="untagged"><meta name=description content="はじめに 自分の個人プロジェクトのDyという、ゲームエンジンプロジェクトがあって、たまに時間がある時開発をしています。ですけど今は表じゃなく裏"><meta name=author content="Jongmin Yun, Neu."><link rel=canonical href=https://liliilli.github.io/posts/dy_cmake/><link crossorigin=anonymous href=/assets/css/stylesheet.min.bc435bed1061be2618667408894ae8a5d27c970831ce57f287e42f911918fcbc.css integrity="sha256-vENb7RBhviYYZnQIiUropdJ8lwgxzlfyh+QvkRkY/Lw=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://liliilli.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://liliilli.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://liliilli.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://liliilli.github.io/apple-touch-icon.png><link rel=mask-icon href=https://liliilli.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.82.0"><meta property="og:title" content="自分でやるDyのCMakeListsファイル説明"><meta property="og:description" content="はじめに 自分の個人プロジェクトのDyという、ゲームエンジンプロジェクトがあって、たまに時間がある時開発をしています。ですけど今は表じゃなく裏"><meta property="og:type" content="article"><meta property="og:url" content="https://liliilli.github.io/posts/dy_cmake/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-08T11:48:19+09:00"><meta property="article:modified_time" content="2020-03-08T19:18:31+09:00"><meta property="og:site_name" content="neuromantic"><meta name=twitter:card content="summary"><meta name=twitter:title content="自分でやるDyのCMakeListsファイル説明"><meta name=twitter:description content="はじめに 自分の個人プロジェクトのDyという、ゲームエンジンプロジェクトがあって、たまに時間がある時開発をしています。ですけど今は表じゃなく裏"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://liliilli.github.io/posts/"},{"@type":"ListItem","position":3,"name":"自分でやるDyのCMakeListsファイル説明","item":"https://liliilli.github.io/posts/dy_cmake/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"自分でやるDyのCMakeListsファイル説明","name":"自分でやるDyのCMakeListsファイル説明","description":"はじめに 自分の個人プロジェクトのDyという、ゲームエンジンプロジェクトがあって、たまに時間がある時開発をしています。ですけど今は表じゃなく裏","keywords":["untagged"],"articleBody":"はじめに 自分の個人プロジェクトのDyという、ゲームエンジンプロジェクトがあって、たまに時間がある時開発をしています。ですけど今は表じゃなく裏で色々と構造上の問題の修正とか、会社で勉強になったところを適用しつつgitを使用せずにこっそりとやったのです。（伏線）\nところで、何日前に酔っ払って家に帰ってきてから開発をしようとしたけど、無闇にCMakeLists.txtファイルを消してしまいました。やべぇと思いながら削除したファイルを戻そうとしましたが、VS自体で削除したせいで戻せませんでした。当然ビルドも通らなくなりました。\nということで結局書き直さざるを得ませんでしたが、最後にCMakeLists.txtを書いてから半年も過ぎているんでどう書けばいいか全然思いつきませんでした。結局最初からやり直す気持ちでcmakeのメモ記事を書いて勉強し、なんとか書き直したんです。\nここからは真下の全文を最初から読み通して、リマインド用としてどんな要素を使ってコードを書いたかを説明したいと思います。\n説明 ・function(_find_platform) function(_find_platform IVerbose OPlatform) https://cmake.org/cmake/help/v3.14/manual/cmake.1.html#build-tool-modehttps://cmake.org/cmake/help/v3.14/envvar/VERBOSE.html\n _find_platformという名前をもつ関数です。IVerboseでは変数またはVERBOSEが入ります。VERBOSEはcmakeで設定ファイルを作るとき、コマンド引数で-v --verboseを入れることでtrueになるらしいです。\nそれでIVerboseがtrueであれば、変数とかログを出力しようとしてます。\nif (IVerbose)\tcmake_print_variables(CMAKE_HOST_SYSTEM_NAME)endif() https://cmake.org/cmake/help/latest/variable/CMAKE_HOST_SYSTEM_NAME.html\n CMAKE_HOST_SYSTEM_NAMEは今使っているOSの名前を返します。リナックス、ウィンドウズ、マックの場合にはLinux、Windows、Darwinを返します。それじゃないOSの場合にはuname -sで返される文字列を持つようです。\n文字列をOPlatform変数に入れときます。関数から外側からの変数引数に値を更新する場合にはPARENT_SCOPEを使います。もし、どの分岐にも当たらなかったら変数の値は未定です。（-NOTFOUNDかもしれませんね）\nset(${OPlatform} \"WIN\" PARENT_SCOPE)・function(_check_supported_platform IPlatformKey OIsSupported) function(_find_platform)から取得したキーを検証し、ビルドできるプラットフォームなのかを確認してくれます。まず、ifでIPlatformKey変数を検証する時には以下のようにします。\nif (\"${IPlatformKey}\" STREQUAL \"WIN\")\"\"を抜いて書いてもいいと思いますが、一応安全策として。${}はできるなら必須だと思います。単純にIPlatformKeyで書いちゃうよりはマシ…だと思います。ただし、${}つけられるのはcmake 3.0バージョンから出来るらしいです。\n関数は別の言語のように早めにリターンすることも出来ます。return()を使いましょう。\n・function(_is_windows OBool) プラットフォームがウィンドウズかを確認してくれます。中身は単純に_find_platform関数の呼び出しとウィンドウズなのかを検証する分岐を書いたことに過ぎません。\n・function(_find_winsdk IVerbose … ODir OLibDir OIncDir)  https://github.com/rpavlik/cmake-modules/blob/master/FindWindowsSDK.cmake\n 今使っているOSのがウィンドウズかを確認し、ウィンドウズなら一番最新のSDKのルートパス、Includeパス、そしてライブラリーディレクトリのパスを返します。ここではFindWindowsSDKというモジュールを使って、いちいち手作業でSDKのパス情報などを取得するようにしなくても提供された関数を呼び、変数を参照するだけで情報が取得できるようにしてくれます。\ninclude(FindWindowsSDK)# ... DO SOMETHING get_windowssdk_library_dirs(${_in_ODir} _in_OLibDir)get_windowssdk_include_dirs(${_in_ODir} _in_OIncDir)・macro(dy_setup_build_settings) 基本的なビルド設定を書いてくれます。ソースファイルの取得、IncludeとかInlineフォルダーの検知、C++バージョンの設定、属性（Property）の設定とビルドオプションを付けること等をやってくれます。\n関数とは違ってマクロなため、各種要素のスコープ管理処理が若干ややこしくなります。\nCMAKE_BUILD_TYPE  https://cmake.org/cmake/help/v3.0/variable/CMAKE_BUILD_TYPE.html\n プロジェクト全般のビルドタイプの文字列を持ちます。例えば、デバッグモードでビルドする時にはDebugまたはDEBUGを、リリースモードでやる時にはReleaseとかRELEASEという文字列を持ちます。（環境によって異なる可能性もあります。）\nそしてこの文字列はCMAKE_CXX_FLAGS_のにも影響を及ぶそうです。ビルドモードによってCMAKE_CXX_FLAGS_Debug、_Releaseになれるらしいです。僕の書いたコードではこのを後で見るGenerator Expressionを制御する時に使います。\nmessage(STATUS \"${PROJECT_NAME} is built with ${CMAKE_BUILD_TYPE} mode.\").ccファイルリストの取得、フィルタリング 以前のCMakeLists.txtファイルでは、各プロジェクトごとに一々ソースファイルを登録しなければなりませんでした。\ntarget_sources(${PROJECT_NAME} PRIVATE XTFVector.cc XString.cc XFMemPool.cc # などなど... \tUtility/test_bit_operation.cc )ですが、今新しく設定ファイルを書く時には一々ファイルのパスを書く手間をなくすよう、Srcフォルダーから子フォルダーの中に入っているファイルを検索して、cppソースファイルを自動に取得するようにしてくれるようにしました。\n https://cmake.org/cmake/help/v3.14/command/file.htmlhttps://cmake.org/cmake/help/v3.14/command/file.html#filesystem\n file()はファイルシステムのファイルまたはディレクトリに接近するときに使うコマンドです。ここでフォルダーの中のファイルを全部取得するためにGLOB_RECURSEを使います。file()コマンド構文の最後に出るのが${CMAKE_CURRENT_SOURCE_DIR}/Srcフォルダーから特定ファイルを探すための表現式となります。下の場合にはすべての.ccファイルのパスを探して、${PROJECT_NAME}_InGetSrcs変数に値を更新します。ただしRELATIVEがあるため、絶対パスじゃなく相対パスとなります。\ncmake 3.12バージョンからはCONFIGURE_DEPENDSが追加されたため、追加しときました。そもそもソースファイルを取得するためにGLOB系列を使うのはおすすめしない方法です。なぜならこのソースファイルリストはファイルを追加するか削除するたびに更新してくれず、あくまでcmakeのキャッシュなどを再設定（Reconfiguration）する時だけ更新するからです。\nなのでCONFIGURE_DEPENDSを追加することで、一応ビルドタイムでもソースファイルリストを更新する必要があるかをチェックし、GLOBコマンドを再度回してくれるようになります。ですが、ソースファイルの量が多くなると以前よりは時間がかかるかもしれません。\nリストを取得する名前もちょっと変わってます。変数のスコープが全域になるかもしれないので、接頭詞としてプロジェクトの名前を付けた変数を使ってます。例えば、プロジェクトの名前がHogeFugaだとしたら、変数の名前はHogeFuga_InGetSrcsになります。\nset(${PROJECT_NAME}_InGetSrcs)file( GLOB_RECURSE ${PROJECT_NAME}_InGetSrcs RELATIVE \"${CMAKE_CURRENT_SOURCE_DIR}/Src\" CONFIGURE_DEPENDS *.cc )ソースファイルのリストを取得してターゲット（プロジェクト）に追加する前に、_xxxx.ccみたいに接頭詞_が付いたファイルは除外する必要があります。なぜなら上のコードではビルドする必要がないソースファイルまで取得してしまうからです。\n https://cmake.org/cmake/help/latest/command/string.html#regex-specificationhttps://cmake.org/cmake/help/latest/command/foreach.html\n ここでビルドしないソースファイルをフィルタリングするため、正規表現パターンを使います。ただ、一般正規表現エンジンみたいに複雑な表現をマッチングさせることは出来ないみたいです。使える正規表現は上のURLで見れます。\nとにかく複数の値を持つ変数を巡回させるにはforeach()とendforeach()を使います。SrcItemは${PROJECT_NAME}_InGetSrcsの持っている複数の値を一個ずつ持ち、中身で何らかのロジックを行います。また、ループ文の中で次のループに移りたい場合にはcontinue()を使います。\nforeach(SrcItem ${${PROJECT_NAME}_InGetSrcs})\tif (\"Src/${SrcItem}\" MATCHES \"/_+[a-zA-Z0-9_ -]*.cc$\")\tcontinue()\telse()\ttarget_sources(${PROJECT_NAME} PRIVATE \"Src/${SrcItem}\")\tendif()endforeach()Inc、Inlフォルダーの確認・取得  https://cmake.org/cmake/help/latest/command/if.html#condition-syntax\n ディレクトリまたはファイルがあるかを確認するには、if (EXISTS )を使います。\nif (EXISTS \"${CMAKE_CURRENT_SOURCE_DIR}/Inc\")\ttarget_include_directories(${PROJECT_NAME} PUBLIC Inc)endif()if (EXISTS \"${CMAKE_CURRENT_SOURCE_DIR}/Inl\")\ttarget_include_directories(${PROJECT_NAME} PUBLIC Inl)endif()Windows専用Include・ライブラリー追加 cmakeを使っているOSがWindowsならば、Windowsから提供している昨日などを使うためにIncludeとLibraryのパスを指定する必要があります。なので追加でSDKのインクルードパスとライブラリーパスを指定するようしてます。\nですが、今はライブラリーパスのみターゲットへ反映するようにしています。インクルードはやっちゃうとWarningエラーがめちゃくちゃ出てるせいでコメント化してます。多分Clang-ClまたはMSVCは自動でSDKのパスをインクルードかけてくれるみたいです。\n# It seems it have not to be inserted into all project when WIN. \t# target_include_directories(${PROJECT_NAME} PRIVATE ${WinInc}) \ttarget_link_directories(${PROJECT_NAME} PRIVATE ${WinLib})\t\ttarget_compile_definitions(${PROJECT_NAME} PRIVATE \"UNICODE\" \"_UNICODE\" \"_CRT_SECURE_NO_WARNINGS\" )ちなみに僕のプロジェクトではマルチバイト文字ではなく、ユニコード文字を使います。\nPropertyの適用  https://cmake.org/cmake/help/latest/command/set_target_properties.htmlhttps://cmake.org/cmake/help/latest/manual/cmake-properties.7.html#target-properties\n ターゲットプロジェクトに属性（Property）を適用するためには、set_target_propertiesを使います。このコマンドが出来る前までは、CXX_...で始まる全域変数を使って、全てのプロジェクトに同一な属性をつけるしかなかったそうですが、バージョン3.0からは..._target_...みたいなコマンドで個別ターゲットを制御するようになったそうです。\nとにかく、ターゲットの属性をつけるにはPROPERTIESの後から属性を付けます。下のコードではCXX_STANDARDという、Cppのバージョンを付けませんでしたが、それは後でコマンドラインまたは別個のプロジェクトCMakeLists.txtでつけるようになってます。もし何も指定されなかった場合にはC++17を自動に付けてあげます。\nset_target_properties(${PROJECT_NAME} PROPERTIES LINKER_LANGUAGE CXX CXX_STANDARD_REQUIRED ON CXX_EXTENSIONS ON ARCHIVE_OUTPUT_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}/lib/${CMAKE_BUILD_TYPE}\" LIBRARY_OUTPUT_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}/lib/${CMAKE_BUILD_TYPE}\" RUNTIME_OUTPUT_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}/bin/${CMAKE_BUILD_TYPE}\" )コンパイルオプション 最後にプロジェクトをビルドする時のフラグを入れます。ただし、コンパイラごとにフラグに入れ方が違うため、CMAKE_CXX_COMPILER_ID全域変数を参照してコンパイラごとのフラグを入れる分岐を作ります。\nif ((\t# MSVC or Clang-Cl (Simulated MSVC on Clang) \t${CMAKE_CXX_COMPILER_ID} STREQUAL \"Clang\" AND \"x${CMAKE_CXX_SIMULATE_ID}\" STREQUAL \"xMSVC\" ) OR ${CMAKE_CXX_COMPILER_ID} STREQUAL \"MSVC\")\t# Clang-Cl, MSVC Flags elseif(${CMAKE_CXX_COMPILER_ID} STREQUAL \"Clang\")\t# Clang Flags else()\tmessage(FATAL_ERROR \"This project only supports Clang/Clang-cl or MSVC compiler now.\")endif()ここで注意すべきところは、WindowsのVS（Visual Studio）でcmakeを使い、そしてVSから提供しているClangコンパイラではなく、自分のclangを取り入れてビルドさせる場合にはCMAKE_CXX_SIMULATE_IDも検査する必要があります。（基本提供しているClangコンパイラでも起こりえる可能性はあります。）\nなので、Clang-Clを使ってる時には、\nif (${CMAKE_CXX_COMPILER_ID} STREQUAL \"Clang\" AND ${CMAKE_CXX_SIMULATE_ID} STREQUAL \"MSVC\")\t# DO SOMETHING endif()で検査します。\nコンパイラの検査が通ったら、target_compile_optionsを使い、フラグを入れます。3.0以前のバージョンではCXX_FLAGSみたいなものを使ってたそうですが、あのやり方じゃ全体プロジェクトのフラグへ影響がありえます。なので今はtarget_compile_optionsを使ってターゲットごとのフラグを設定します。\nちょっと注目すべきところは、generator expressionを使ってるとこです。$:${ComOpts_MsvcDebug}またはDebugがReleaseにされているのが２つも存在しているのは、上で説明していたの文字列を見て、ビルドする時にビルドモードによってフラグを洗濯的に入れるためです。\n例えば、Debugモードの場合には２つめは無視され、１つ目はComOpts_MscvDebug変数で指定されたフラグリストがターゲットに入ります。Releaseモードならば逆です。各フラグ変数はコード一番下で書いています。\ntarget_compile_options(${PROJECT_NAME} PUBLIC \"$:${ComOpts_MsvcDebug}\")target_compile_options(${PROJECT_NAME} PUBLIC \"$:${ComOpts_MsvcRelease}\")set(ComOpts_MsvcCommon /GR- /W4 /WX /MP -Wno-error=unused-command-line-argument -Wno-error=expansion-to-defined -Wno-error=ignored-pragma-intrinsic ) set(ComOpts_MsvcDebug /Od ${ComOpts_MsvcCommon})set(ComOpts_MsvcRelease /O2 ${ComOpts_MsvcCommon})プロジェクトごとのCMakeLists.txt 各プロジェクトでは下だけを書くことで終わります。\ncmake_minimum_required(VERSION 3.12)project(DyCommon LANGUAGES CXX)add_library(${PROJECT_NAME} STATIC)dy_setup_build_settings()または\ncmake_minimum_required (VERSION 3.12)project(TestD3D12 CXX)add_executable(${PROJECT_NAME})add_dependencies(${PROJECT_NAME} DyCommon)target_link_libraries(${PROJECT_NAME} PUBLIC DyCommon)set_target_properties(${PROJECT_NAME} PROPERTIES CXX_STANDARD 20)dy_setup_build_settings()ほとんどはdy_setup_build_settingsマクロが設定してくれます。はい、おわり。\n反省点 Unity Buildまたは類似Unityの導入？ 今はfile(GLOB_RECURSE)でソースファイルをまとめてターゲットにバインディングしているようにしてますが、やるならfileコマンドをより活用して一時のUnityビルドファイルを作り、そこにリストをインクルードするコードをCmake側から書いてUnityファイルだけビルド通るようにすることも良さそうじゃないかな～と思いました。\nまず、file(GLOB)自体が設定時にコマンド実行が行うため、設定後で新しいファイルを追加しようとしたら再度設定をし直さなければならないです。生産性も下がりそうだし、ビルドするまでの時間もかかりそうだから、やるならUnityビルドしかけたりする方が良いんじゃね…？とふと思いつきました。\n後で試してみて、上手く出来たらコード改良して切り換えたいです。\nD3D12ライブラリ導入の制御が足りない 現在のコードでは、WindowsならD3D12も自動に入れるようにしています。ですが、D3D12のライブラリは基本的にはWindows10以上のみ対応しているらしく、以前のWindowsOSでは当然ビルドエラーが出ちゃうか、意図してない挙動になれると思います。\nなんで、解決策としてoptionコマンドなどでD3D12を入れるかないかを設定するようにし、OSのプラットフォームを詳しく区別させてWin10ではなければD3D12のインポートを解除するようにしつつ、フラグのtrue/falseによって洗濯的にライブラリを入れるようにコードを修正すれば良いんじゃないかなと思いますね。\nadd_subdirectoryではなく、IMPORTで出来るのでは？  https://www.youtube.com/watch?v=y7ndUhdQuU8https://www.youtube.com/watch?v=y9kSr5enrSk\n add_subdirectoryではなく、IMPORTでプロジェクトを関連させたりビルドさせたりすることが出来るらしいけど、詳しくは存じないです。単純に勘違いしたかもしれませんね…\n警告メッセージをむりやり抑えてしまった Cmake＋Clang-Clでは/MP（マルチプロセッサで並列ビルドを行う）フラグが通じないみたいです。/W4 /WXまで付けたせいでエラーが出まくって、一応-Wnoフラグでなんとか警告として扱うように抑えましたが、ちょっと気に食わないですね。\n全文 cmake_minimum_required(VERSION 3.12)project(Dy CXX)# @brief Find platform key string if found. #\tReturned `OPlatform` key string is one of below list when found. #\t* WIN : Windows #\t* LNX : Linux #\t* MAC : MacOS (Darwin) #\tIf not found, key string will be `-NOTFOUND`. # # @param IVerbose verbosity flag. input value is true / false. # @return_var OPlatform function(_find_platform IVerbose OPlatform)\tif (IVerbose)\tcmake_print_variables(CMAKE_HOST_SYSTEM_NAME)\tendif()\tif (\"${CMAKE_HOST_SYSTEM_NAME}\" STREQUAL \"Windows\")\tif (IVerbose)\tmessage(STATUS \"Found Windows.\")\tendif()\tset(${OPlatform} \"WIN\" PARENT_SCOPE)\telseif(\"${CMAKE_HOST_SYSTEM_NAME}\" STREQUAL \"Linux\")\tif (IVerbose)\tmessage(STATUS \"Found Linux.\")\tendif()\tset(${OPlatform} \"LNX\" PARENT_SCOPE)\telseif(\"${CMAKE_HOST_SYSTEM_NAME}\" STREQUAL \"Darwin\")\tif (IVerbose)\tmessage(STATUS \"Found MacOS.\")\tendif()\tset(${OPlatform} \"MAC\" PARENT_SCOPE)\tendif()endfunction()# @brief Check given platform is supported with `IPlatformKey` variable. #\tReturned `OIsSupported` key have true or false whether given platform is supported or not. #\t* true : Detected platform is suppported. #\t* false : Detected platform is not supported yet. # # @param IPlatformKey Get platform key by using _find_platform function. # @return_var OIsSupported function(_check_supported_platform IPlatformKey OIsSupported)\tif (\"${IPlatformKey}\" STREQUAL \"WIN\")\tset(${OIsSupported} true PARENT_SCOPE)\treturn()\tendif()\t# If there is no matched key, just return with false. \tset(${OISSupported} false PARENT_SCOPE)endfunction()# @brief Check if platform is windows. # # @return_var OBool function(_is_windows OBool)\t_find_platform(false _in_key)\tif (\"${_in_key}\" STREQUAL \"WIN\")\tset(${OBool} true PARENT_SCOPE)\treturn()\tendif()\t# If not matched, return false. \tset(${OBool} false PARENT_SCOPE)endfunction()# @brief Find Windows SDK pathes and properties information. # # @return_var ODirs All found SDK path list. # @return_var OBuildVers NOt used # @return_var ONames Not used # @return_var ODir Latest SDK path. # @return_var OLibDir Latest SDK include file path. # @return_var OIncDir Latest SDK library file path. function(_find_winsdk IVerbose ODirs OBuildVers ONames ODir OLibDir OIncDir)\t_is_windows(_in_flag)\tif (_in_flag)\tinclude(FindWindowsSDK)\t# \tif (NOT WINDOWSSDK_FOUND)\tmessage(FATAL_ERROR \"Proper Windows SDK is not found.\")\treturn()\tendif()\t# \tif (IVerbose)\tcmake_print_variables(WINDOWSSDK_DIRS)\tcmake_print_variables(WINDOWSSDK_FOUND_PREFERENCE)\tcmake_print_variables(WINDOWSSDK_LATEST_NAME)\tcmake_print_variables(WINDOWSSDK_LATEST_DIR)\tendif()\t# Update variables. \tset(${ODirs} ${WINDOWSSDK_DIRS} PARENT_SCOPE)\tset(${ODir} ${WINDOWSSDK_LATEST_DIR} PARENT_SCOPE)\tset(_in_ODir ${WINDOWSSDK_LATEST_DIR})\tget_windowssdk_library_dirs(${_in_ODir} _in_OLibDir)\tget_windowssdk_include_dirs(${_in_ODir} _in_OIncDir)\twindowssdk_name_lookup(${_in_ODir} _in_ONames)\twindowssdk_build_lookup(${_in_ODir} _in_OBuildVers)\tset(${OBuildVers} ${_in_OBuildVers} PARENT_SCOPE)\tset(${ONames} ${_in_ONames} PARENT_SCOPE)\tset(${OLibDir} ${_in_OLibDir} PARENT_SCOPE)\tset(${OIncDir} ${_in_OIncDir} PARENT_SCOPE)\tendif()endfunction()# @macro dy_setup_build_settings # # @brief Set up default build settings. #\tEvery project that needs to be built should be call this macro. macro(dy_setup_build_settings)\tmessage(STATUS \"${PROJECT_NAME} is built with ${CMAKE_BUILD_TYPE} mode.\")\t# If there are source files in /Src, add source files (.cc) but except for prefix `_` files. \tset(${PROJECT_NAME}_InGetSrcs)\tfile( GLOB_RECURSE ${PROJECT_NAME}_InGetSrcs RELATIVE \"${CMAKE_CURRENT_SOURCE_DIR}/Src\" CONFIGURE_DEPENDS *.cc )\t# Check if there are `Inc` and `Inl` directory in ${CMAKE_CURRENT_SOURCE_DIR}. \tif (${PROJECT_NAME}_InGetSrcs)\t# If exist, add target_include_directories as PUBLIC. \tif (EXISTS \"${CMAKE_CURRENT_SOURCE_DIR}/Inc\")\ttarget_include_directories(${PROJECT_NAME} PUBLIC Inc)\tendif()\tif (EXISTS \"${CMAKE_CURRENT_SOURCE_DIR}/Inl\")\ttarget_include_directories(${PROJECT_NAME} PUBLIC Inl)\tendif()\telse()\t# If exist, add target_include_directories as INTERFACE. \tif (EXISTS \"${CMAKE_CURRENT_SOURCE_DIR}/Inc\")\ttarget_include_directories(${PROJECT_NAME} INTERFACE Inc)\tendif()\tif (EXISTS \"${CMAKE_CURRENT_SOURCE_DIR}/Inl\")\ttarget_include_directories(${PROJECT_NAME} INTERFACE Inl)\tendif()\tendif()\t# ...To match a literal - using brackets, \t# make it the first or the last character e.g. [+*/-] matches basic mathematical operators. \tforeach(SrcItem ${${PROJECT_NAME}_InGetSrcs})\tif (\"Src/${SrcItem}\" MATCHES \"/_+[a-zA-Z0-9_ -]*.cc$\")\tcontinue()\telse()\ttarget_sources(${PROJECT_NAME} PRIVATE \"Src/${SrcItem}\")\tendif()\tendforeach()\t# Set CXX Properties \tget_target_property(CxxStdVersion ${PROJECT_NAME} CXX_STANDARD)\tif (CxxStdVersion)\tmessage(STATUS \"${PROJECT_NAME} is built with C++${CxxStdVersion}\")\telse ()\t# -NOTFOUND \tset(CxxStdVersion 17)\tset_property(TARGET ${PROJECT_NAME} PROPERTY CXX_STANDARD 17)\ttarget_compile_definitions(${PROJECT_NAME} PUBLIC CPP_DyCommon_VER_17)\tendif()\t# Set properties. \tset_target_properties(${PROJECT_NAME} PROPERTIES LINKER_LANGUAGE CXX CXX_STANDARD_REQUIRED ON CXX_EXTENSIONS ON ARCHIVE_OUTPUT_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}/lib/${CMAKE_BUILD_TYPE}\" LIBRARY_OUTPUT_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}/lib/${CMAKE_BUILD_TYPE}\" RUNTIME_OUTPUT_DIRECTORY \"${CMAKE_CURRENT_SOURCE_DIR}/bin/${CMAKE_BUILD_TYPE}\" )\t# Add compile option flags. \tif ((\t# MSVC or Clang-Cl (Simulated MSVC on Clang) \t${CMAKE_CXX_COMPILER_ID} STREQUAL \"Clang\" AND \"x${CMAKE_CXX_SIMULATE_ID}\" STREQUAL \"xMSVC\" ) OR ${CMAKE_CXX_COMPILER_ID} STREQUAL \"MSVC\")\t# CXX Flags. \tif (${CxxStdVersion} EQUAL \"20\")\ttarget_compile_options(${PROJECT_NAME} PUBLIC \"/std:c++latest\")\telse()\ttarget_compile_options(${PROJECT_NAME} PUBLIC \"/std:c++${CxxStdVersion}\")\tendif()\t# Additional Flags. \t# https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html \ttarget_compile_options(${PROJECT_NAME} PUBLIC \"$:${ComOpts_MsvcDebug}\")\ttarget_compile_options(${PROJECT_NAME} PUBLIC \"$:${ComOpts_MsvcRelease}\")\telseif(${CMAKE_CXX_COMPILER_ID} STREQUAL \"Clang\")\t# CXX Flags. \ttarget_compile_options(${PROJECT_NAME} PUBLIC \"-std=c++${CxxStdVersion}\")\t# Additional Flags. \ttarget_compile_options(${PROJECT_NAME} PUBLIC \"$:${ComOpts_ClangDebug}\")\ttarget_compile_options(${PROJECT_NAME} PUBLIC \"$:${ComOpts_ClangRelease}\")\telse()\tmessage(FATAL_ERROR \"This project only supports Clang/Clang-cl or MSVC compiler now.\")\tendif()\t# If windows, let project add WIN32 and D3D12 libraries. \t_is_windows(${PROJECT_NAME}IsWin)\tif (${PROJECT_NAME}IsWin)\t# It seems it have not to be inserted into all project when WIN. \t# target_include_directories(${PROJECT_NAME} PRIVATE ${WinInc}) \ttarget_link_directories(${PROJECT_NAME} PRIVATE ${WinLib})\ttarget_compile_definitions(${PROJECT_NAME} PRIVATE \"UNICODE\" \"_UNICODE\" \"_CRT_SECURE_NO_WARNINGS\" )\ttarget_link_libraries(${PROJECT_NAME} PRIVATE \"d3d12.lib\" \"d3dcompiler.lib\" \"dxgi.lib\" )\tendif()endmacro()# ----------------------------------------------------------------------------- # # MAIN ROUTINES # # ----------------------------------------------------------------------------- set(CMAKE_VERBOSE_MAKEFILE true)set(CMAKE_MODULE_PATH \"${CMAKE_SOURCE_DIR}/Module\")include(CMakePrintHelpers)include(cotire)_find_platform(VERBOSE, PlatformKey)_check_supported_platform(PlatformKey, IsSupportedPlatform)if (IsSupportedPlatform EQUAL false)\tmessage(FATAL_ERROR \"${PlatformKey} is not supported platform.\")endif()_is_windows(_out_iswindows)if (_out_iswindows)\t_find_winsdk(VERBOSE WinDirs WinBuildVers WinName WinDir WinLib WinInc)\tif (VERBOSE)\tcmake_print_variables(WinDirs)\tcmake_print_variables(WinDir)\tcmake_print_variables(WinLib)\tcmake_print_variables(WinInc)\tcmake_print_variables(WinName)\tcmake_print_variables(WinBuildVers)\tendif()endif()# # Compiler Flags # set(ComOpts_MsvcCommon /GR- /W4 /WX /MP -Wno-error=unused-command-line-argument -Wno-error=expansion-to-defined -Wno-error=ignored-pragma-intrinsic ) set(ComOpts_MsvcDebug /Od ${ComOpts_MsvcCommon})set(ComOpts_MsvcRelease /O2 ${ComOpts_MsvcCommon})set(ComOpts_ClangCommon -Wall -Werror)set(ComOpts_ClangDebug ${ComOpts_ClangCommon})set(ComOpts_ClangRelease -O3 ${ComOpts_ClangCommon})# # Subdirectory (Need to be changed with IMPORT module.) # add_subdirectory(Engine)add_subdirectory(TestPrj)add_subdirectory(ThirdParty)","wordCount":"6926","inLanguage":"en","datePublished":"2020-03-08T11:48:19+09:00","dateModified":"2020-03-08T19:18:31+09:00","author":{"@type":"Person","name":"Jongmin Yun, Neu."},"mainEntityOfPage":{"@type":"WebPage","@id":"https://liliilli.github.io/posts/dy_cmake/"},"publisher":{"@type":"Organization","name":"neuromantic","logo":{"@type":"ImageObject","url":"https://liliilli.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://liliilli.github.io accesskey=h title="neuromantic (Alt + H)">neuromantic</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://liliilli.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://liliilli.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://liliilli.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://liliilli.github.io/series/ title=Series><span>Series</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://liliilli.github.io>Home</a>&nbsp;»&nbsp;<a href=https://liliilli.github.io/posts/>Posts</a></div><h1 class=post-title>自分でやるDyのCMakeListsファイル説明</h1><div class=post-meta>2020, March 8&nbsp;·&nbsp;Jongmin Yun, Neu.</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#%e3%81%af%e3%81%98%e3%82%81%e3%81%ab aria-label=はじめに>はじめに</a></li><li><a href=#%e8%aa%ac%e6%98%8e aria-label=説明>説明</a><ul><li><a href=#function_find_platform aria-label=・function(_find_platform)>・function(_find_platform)</a></li><li><a href=#function_check_supported_platform-iplatformkey-oissupported aria-label="・function(_check_supported_platform IPlatformKey OIsSupported)">・function(_check_supported_platform IPlatformKey OIsSupported)</a></li><li><a href=#function_is_windows-obool aria-label="・function(_is_windows OBool)">・function(_is_windows OBool)</a></li><li><a href=#function_find_winsdk-iverbose--odir-olibdir-oincdir aria-label="・function(_find_winsdk IVerbose &amp;hellip; ODir OLibDir OIncDir)">・function(_find_winsdk IVerbose &mldr; ODir OLibDir OIncDir)</a></li><li><a href=#macrody_setup_build_settings aria-label=・macro(dy_setup_build_settings)>・macro(dy_setup_build_settings)</a><ul><li><a href=#cmake_build_type aria-label=CMAKE_BUILD_TYPE>CMAKE_BUILD_TYPE</a></li><li><a href=#cc%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%83%aa%e3%82%b9%e3%83%88%e3%81%ae%e5%8f%96%e5%be%97%e3%83%95%e3%82%a3%e3%83%ab%e3%82%bf%e3%83%aa%e3%83%b3%e3%82%b0 aria-label=.ccファイルリストの取得、フィルタリング><code>.cc</code>ファイルリストの取得、フィルタリング</a></li><li><a href=#incinl%e3%83%95%e3%82%a9%e3%83%ab%e3%83%80%e3%83%bc%e3%81%ae%e7%a2%ba%e8%aa%8d%e5%8f%96%e5%be%97 aria-label=Inc、Inlフォルダーの確認・取得>Inc、Inlフォルダーの確認・取得</a></li><li><a href=#windows%e5%b0%82%e7%94%a8include%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%83%bc%e8%bf%bd%e5%8a%a0 aria-label=Windows専用Include・ライブラリー追加>Windows専用Include・ライブラリー追加</a></li><li><a href=#property%e3%81%ae%e9%81%a9%e7%94%a8 aria-label=Propertyの適用>Propertyの適用</a></li><li><a href=#%e3%82%b3%e3%83%b3%e3%83%91%e3%82%a4%e3%83%ab%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3 aria-label=コンパイルオプション>コンパイルオプション</a></li></ul></li></ul></li><li><a href=#%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%94%e3%81%a8%e3%81%aecmakeliststxt aria-label=プロジェクトごとのCMakeLists.txt>プロジェクトごとのCMakeLists.txt</a></li><li><a href=#%e5%8f%8d%e7%9c%81%e7%82%b9 aria-label=反省点>反省点</a><ul><ul><li><a href=#unity-build%e3%81%be%e3%81%9f%e3%81%af%e9%a1%9e%e4%bc%bcunity%e3%81%ae%e5%b0%8e%e5%85%a5 aria-label="Unity Buildまたは類似Unityの導入？">Unity Buildまたは類似Unityの導入？</a></li><li><a href=#d3d12%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e5%b0%8e%e5%85%a5%e3%81%ae%e5%88%b6%e5%be%a1%e3%81%8c%e8%b6%b3%e3%82%8a%e3%81%aa%e3%81%84 aria-label=D3D12ライブラリ導入の制御が足りない>D3D12ライブラリ導入の制御が足りない</a></li><li><a href=#add_subdirectory%e3%81%a7%e3%81%af%e3%81%aa%e3%81%8fimport%e3%81%a7%e5%87%ba%e6%9d%a5%e3%82%8b%e3%81%ae%e3%81%a7%e3%81%af aria-label=add_subdirectoryではなく、IMPORTで出来るのでは？>add_subdirectoryではなく、IMPORTで出来るのでは？</a></li><li><a href=#%e8%ad%a6%e5%91%8a%e3%83%a1%e3%83%83%e3%82%bb%e3%83%bc%e3%82%b8%e3%82%92%e3%82%80%e3%82%8a%e3%82%84%e3%82%8a%e6%8a%91%e3%81%88%e3%81%a6%e3%81%97%e3%81%be%e3%81%a3%e3%81%9f aria-label=警告メッセージをむりやり抑えてしまった>警告メッセージをむりやり抑えてしまった</a></li></ul></ul></li><li><a href=#%e5%85%a8%e6%96%87 aria-label=全文>全文</a></li></ul></div></details></div><div class=post-content><h1 id=はじめに>はじめに<a hidden class=anchor aria-hidden=true href=#はじめに>#</a></h1><p>自分の個人プロジェクトの<code>Dy</code>という、ゲームエンジンプロジェクトがあって、たまに時間がある時開発をしています。ですけど今は表じゃなく裏で色々と構造上の問題の修正とか、会社で勉強になったところを適用しつつ<code>git</code>を使用せずにこっそりとやったのです。（伏線）</p><p>ところで、何日前に酔っ払って家に帰ってきてから開発をしようとしたけど、無闇に<code>CMakeLists.txt</code>ファイルを消してしまいました。やべぇと思いながら削除したファイルを戻そうとしましたが、VS自体で削除したせいで戻せませんでした。当然ビルドも通らなくなりました。</p><p>ということで結局書き直さざるを得ませんでしたが、最後に<code>CMakeLists.txt</code>を書いてから半年も過ぎているんでどう書けばいいか全然思いつきませんでした。結局最初からやり直す気持ちで<code>cmake</code>のメモ記事を書いて勉強し、なんとか書き直したんです。</p><p>ここからは真下の全文を最初から読み通して、リマインド用としてどんな要素を使ってコードを書いたかを説明したいと思います。</p><h1 id=説明>説明<a hidden class=anchor aria-hidden=true href=#説明>#</a></h1><h2 id=function_find_platform>・function(_find_platform)<a hidden class=anchor aria-hidden=true href=#function_find_platform>#</a></h2><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>function</span><span class=p>(</span><span class=s>_find_platform</span> <span class=s>IVerbose</span> <span class=s>OPlatform</span><span class=p>)</span><span class=err>
</span></code></pre></div><blockquote><p><a href=https://cmake.org/cmake/help/v3.14/manual/cmake.1.html#build-tool-mode>https://cmake.org/cmake/help/v3.14/manual/cmake.1.html#build-tool-mode</a>
<a href=https://cmake.org/cmake/help/v3.14/envvar/VERBOSE.html>https://cmake.org/cmake/help/v3.14/envvar/VERBOSE.html</a></p></blockquote><p><code>_find_platform</code>という名前をもつ関数です。<code>IVerbose</code>では変数または<code>VERBOSE</code>が入ります。<code>VERBOSE</code>はcmakeで設定ファイルを作るとき、コマンド引数で<code>-v --verbose</code>を入れることで<code>true</code>になるらしいです。</p><p>それで<code>IVerbose</code>が<code>true</code>であれば、変数とかログを出力しようとしてます。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>if</span> <span class=p>(</span><span class=s>IVerbose</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>CMAKE_HOST_SYSTEM_NAME</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>endif</span><span class=p>()</span><span class=err>
</span></code></pre></div><blockquote><p><a href=https://cmake.org/cmake/help/latest/variable/CMAKE_HOST_SYSTEM_NAME.html>https://cmake.org/cmake/help/latest/variable/CMAKE_HOST_SYSTEM_NAME.html</a></p></blockquote><p><code>CMAKE_HOST_SYSTEM_NAME</code>は今使っているOSの名前を返します。リナックス、ウィンドウズ、マックの場合には<code>Linux</code>、<code>Windows</code>、<code>Darwin</code>を返します。それじゃないOSの場合には<code>uname -s</code>で返される文字列を持つようです。</p><p>文字列を<code>OPlatform</code>変数に入れときます。関数から外側からの変数引数に値を更新する場合には<code>PARENT_SCOPE</code>を使います。もし、どの分岐にも当たらなかったら変数の値は未定です。（<code>-NOTFOUND</code>かもしれませんね）</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OPlatform</span><span class=o>}</span> <span class=s2>&#34;WIN&#34;</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span></code></pre></div><h2 id=function_check_supported_platform-iplatformkey-oissupported>・function(_check_supported_platform IPlatformKey OIsSupported)<a hidden class=anchor aria-hidden=true href=#function_check_supported_platform-iplatformkey-oissupported>#</a></h2><p><code>function(_find_platform)</code>から取得したキーを検証し、ビルドできるプラットフォームなのかを確認してくれます。まず、<code>if</code>で<code>IPlatformKey</code>変数を検証する時には以下のようにします。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>if</span> <span class=p>(</span><span class=s2>&#34;${IPlatformKey}&#34;</span> <span class=s>STREQUAL</span> <span class=s2>&#34;WIN&#34;</span><span class=p>)</span><span class=err>
</span></code></pre></div><p><code>""</code>を抜いて書いてもいいと思いますが、一応安全策として。<code>${}</code>はできるなら必須だと思います。単純に<code>IPlatformKey</code>で書いちゃうよりはマシ…だと思います。ただし、<code>${}</code>つけられるのはcmake 3.0バージョンから出来るらしいです。</p><p>関数は別の言語のように早めにリターンすることも出来ます。<code>return()</code>を使いましょう。</p><h2 id=function_is_windows-obool>・function(_is_windows OBool)<a hidden class=anchor aria-hidden=true href=#function_is_windows-obool>#</a></h2><p>プラットフォームがウィンドウズかを確認してくれます。中身は単純に<code>_find_platform</code>関数の呼び出しとウィンドウズなのかを検証する分岐を書いたことに過ぎません。</p><h2 id=function_find_winsdk-iverbose--odir-olibdir-oincdir>・function(_find_winsdk IVerbose &mldr; ODir OLibDir OIncDir)<a hidden class=anchor aria-hidden=true href=#function_find_winsdk-iverbose--odir-olibdir-oincdir>#</a></h2><blockquote><p><a href=https://github.com/rpavlik/cmake-modules/blob/master/FindWindowsSDK.cmake>https://github.com/rpavlik/cmake-modules/blob/master/FindWindowsSDK.cmake</a></p></blockquote><p>今使っているOSのがウィンドウズかを確認し、ウィンドウズなら一番最新のSDKのルートパス、Includeパス、そしてライブラリーディレクトリのパスを返します。ここでは<code>FindWindowsSDK</code>というモジュールを使って、いちいち手作業でSDKのパス情報などを取得するようにしなくても提供された関数を呼び、変数を参照するだけで情報が取得できるようにしてくれます。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>include</span><span class=p>(</span><span class=s>FindWindowsSDK</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=c># ... DO SOMETHING
</span><span class=c></span><span class=nb>get_windowssdk_library_dirs</span><span class=p>(</span><span class=o>${</span><span class=nv>_in_ODir</span><span class=o>}</span> <span class=s>_in_OLibDir</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>get_windowssdk_include_dirs</span><span class=p>(</span><span class=o>${</span><span class=nv>_in_ODir</span><span class=o>}</span> <span class=s>_in_OIncDir</span><span class=p>)</span><span class=err>
</span></code></pre></div><h2 id=macrody_setup_build_settings>・macro(dy_setup_build_settings)<a hidden class=anchor aria-hidden=true href=#macrody_setup_build_settings>#</a></h2><p>基本的なビルド設定を書いてくれます。ソースファイルの取得、IncludeとかInlineフォルダーの検知、C++バージョンの設定、属性（Property）の設定とビルドオプションを付けること等をやってくれます。</p><p>関数とは違ってマクロなため、各種要素のスコープ管理処理が若干ややこしくなります。</p><h3 id=cmake_build_type>CMAKE_BUILD_TYPE<a hidden class=anchor aria-hidden=true href=#cmake_build_type>#</a></h3><blockquote><p><a href=https://cmake.org/cmake/help/v3.0/variable/CMAKE_BUILD_TYPE.html>https://cmake.org/cmake/help/v3.0/variable/CMAKE_BUILD_TYPE.html</a></p></blockquote><p>プロジェクト全般のビルドタイプの文字列を持ちます。例えば、デバッグモードでビルドする時には<code>Debug</code>または<code>DEBUG</code>を、リリースモードでやる時には<code>Release</code>とか<code>RELEASE</code>という文字列を持ちます。（環境によって異なる可能性もあります。）</p><p>そしてこの文字列は<code>CMAKE_CXX_FLAGS_&lt;CONFIG></code>の<code>&lt;CONFIG></code>にも影響を及ぶそうです。ビルドモードによって<code>CMAKE_CXX_FLAGS_Debug</code>、<code>_Release</code>になれるらしいです。僕の書いたコードではこの<code>&lt;CONFIG></code>を後で見る<em>Generator Expression</em>を制御する時に使います。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>message</span><span class=p>(</span><span class=s>STATUS</span> <span class=s2>&#34;${PROJECT_NAME} is built with ${CMAKE_BUILD_TYPE} mode.&#34;</span><span class=p>)</span><span class=err>
</span></code></pre></div><h3 id=ccファイルリストの取得フィルタリング><code>.cc</code>ファイルリストの取得、フィルタリング<a hidden class=anchor aria-hidden=true href=#ccファイルリストの取得フィルタリング>#</a></h3><p>以前の<code>CMakeLists.txt</code>ファイルでは、各プロジェクトごとに一々ソースファイルを登録しなければなりませんでした。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>target_sources</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span>
<span class=s>PRIVATE</span>
	<span class=s>XTFVector.cc</span>
	<span class=s>XString.cc</span>
	<span class=s>XFMemPool.cc</span>
	<span class=c># などなど...
</span><span class=c></span>	<span class=s>Utility/test_bit_operation.cc</span>
<span class=p>)</span><span class=err>
</span></code></pre></div><p>ですが、今新しく設定ファイルを書く時には一々ファイルのパスを書く手間をなくすよう、<code>Src</code>フォルダーから子フォルダーの中に入っているファイルを検索して、<code>cpp</code>ソースファイルを自動に取得するようにしてくれるようにしました。</p><blockquote><p><a href=https://cmake.org/cmake/help/v3.14/command/file.html>https://cmake.org/cmake/help/v3.14/command/file.html</a><a href=https://cmake.org/cmake/help/v3.14/command/file.html#filesystem>https://cmake.org/cmake/help/v3.14/command/file.html#filesystem</a></p></blockquote><p><code>file()</code>はファイルシステムのファイルまたはディレクトリに接近するときに使うコマンドです。ここでフォルダーの中のファイルを全部取得するために<code>GLOB_RECURSE</code>を使います。<code>file()</code>コマンド構文の最後に出るのが<code>${CMAKE_CURRENT_SOURCE_DIR}/Src</code>フォルダーから特定ファイルを探すための表現式となります。下の場合にはすべての<code>.cc</code>ファイルのパスを探して、<code>${PROJECT_NAME}_InGetSrcs</code>変数に値を更新します。ただし<code>RELATIVE</code>があるため、絶対パスじゃなく相対パスとなります。</p><p>cmake 3.12バージョンからは<code>CONFIGURE_DEPENDS</code>が追加されたため、追加しときました。そもそもソースファイルを取得するために<code>GLOB</code>系列を使うのはおすすめしない方法です。なぜならこのソースファイルリストはファイルを追加するか削除するたびに更新してくれず、あくまでcmakeのキャッシュなどを再設定（Reconfiguration）する時だけ更新するからです。</p><p>なので<code>CONFIGURE_DEPENDS</code>を追加することで、一応ビルドタイムでもソースファイルリストを更新する必要があるかをチェックし、<code>GLOB</code>コマンドを再度回してくれるようになります。ですが、ソースファイルの量が多くなると以前よりは時間がかかるかもしれません。</p><p>リストを取得する名前もちょっと変わってます。変数のスコープが全域になるかもしれないので、接頭詞としてプロジェクトの名前を付けた変数を使ってます。例えば、プロジェクトの名前が<code>HogeFuga</code>だとしたら、変数の名前は<code>HogeFuga_InGetSrcs</code>になります。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span><span class=s>_InGetSrcs</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>file</span><span class=p>(</span>
	<span class=s>GLOB_RECURSE</span> <span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span><span class=s>_InGetSrcs</span>
	<span class=s>RELATIVE</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/Src&#34;</span>
	<span class=s>CONFIGURE_DEPENDS</span> <span class=s>*.cc</span>
<span class=p>)</span><span class=err>
</span></code></pre></div><p>ソースファイルのリストを取得してターゲット（プロジェクト）に追加する前に、<code>_xxxx.cc</code>みたいに接頭詞<code>_</code>が付いたファイルは除外する必要があります。なぜなら上のコードではビルドする必要がないソースファイルまで取得してしまうからです。</p><blockquote><p><a href=https://cmake.org/cmake/help/latest/command/string.html#regex-specification>https://cmake.org/cmake/help/latest/command/string.html#regex-specification</a><a href=https://cmake.org/cmake/help/latest/command/foreach.html>https://cmake.org/cmake/help/latest/command/foreach.html</a></p></blockquote><p>ここでビルドしないソースファイルをフィルタリングするため、正規表現パターンを使います。ただ、一般正規表現エンジンみたいに複雑な表現をマッチングさせることは出来ないみたいです。使える正規表現は上のURLで見れます。</p><p>とにかく複数の値を持つ変数を巡回させるには<code>foreach()</code>と<code>endforeach()</code>を使います。<code>SrcItem</code>は<code>${PROJECT_NAME}_InGetSrcs</code>の持っている複数の値を一個ずつ持ち、中身で何らかのロジックを行います。また、ループ文の中で次のループに移りたい場合には<code>continue()</code>を使います。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>foreach</span><span class=p>(</span><span class=s>SrcItem</span> <span class=o>${</span><span class=nv>${PROJECT_NAME</span><span class=o>}</span><span class=s>_InGetSrcs}</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>if</span> <span class=p>(</span><span class=s2>&#34;Src/${SrcItem}&#34;</span> <span class=s>MATCHES</span> <span class=s2>&#34;/_+[a-zA-Z0-9_ -]*.cc$&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>continue</span><span class=p>()</span><span class=err>
</span><span class=err></span>	<span class=nb>else</span><span class=p>()</span><span class=err>
</span><span class=err></span>		<span class=nb>target_sources</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PRIVATE</span> <span class=s2>&#34;Src/${SrcItem}&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span><span class=nb>endforeach</span><span class=p>()</span><span class=err>
</span></code></pre></div><h3 id=incinlフォルダーの確認取得>Inc、Inlフォルダーの確認・取得<a hidden class=anchor aria-hidden=true href=#incinlフォルダーの確認取得>#</a></h3><blockquote><p><a href=https://cmake.org/cmake/help/latest/command/if.html#condition-syntax>https://cmake.org/cmake/help/latest/command/if.html#condition-syntax</a></p></blockquote><p>ディレクトリまたはファイルがあるかを確認するには、<code>if (EXISTS &lt;path>)</code>を使います。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>if</span> <span class=p>(</span><span class=s>EXISTS</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/Inc&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>target_include_directories</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s>Inc</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span><span class=nb>if</span> <span class=p>(</span><span class=s>EXISTS</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/Inl&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>target_include_directories</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s>Inl</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>endif</span><span class=p>()</span><span class=err>
</span></code></pre></div><h3 id=windows専用includeライブラリー追加>Windows専用Include・ライブラリー追加<a hidden class=anchor aria-hidden=true href=#windows専用includeライブラリー追加>#</a></h3><p>cmakeを使っているOSがWindowsならば、Windowsから提供している昨日などを使うためにIncludeとLibraryのパスを指定する必要があります。なので追加でSDKのインクルードパスとライブラリーパスを指定するようしてます。</p><p>ですが、今はライブラリーパスのみターゲットへ反映するようにしています。インクルードはやっちゃうとWarningエラーがめちゃくちゃ出てるせいでコメント化してます。多分Clang-ClまたはMSVCは自動でSDKのパスをインクルードかけてくれるみたいです。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake>	<span class=c># It seems it have not to be inserted into all project when WIN.
</span><span class=c></span>	<span class=c># target_include_directories(${PROJECT_NAME} PRIVATE ${WinInc})
</span><span class=c></span>	<span class=nb>target_link_directories</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PRIVATE</span> <span class=o>${</span><span class=nv>WinLib</span><span class=o>}</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=err>
</span><span class=err></span>	<span class=nb>target_compile_definitions</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> 
	<span class=s>PRIVATE</span> 
		<span class=s2>&#34;UNICODE&#34;</span> 
		<span class=s2>&#34;_UNICODE&#34;</span>
		<span class=s2>&#34;_CRT_SECURE_NO_WARNINGS&#34;</span>
	<span class=p>)</span><span class=err>
</span></code></pre></div><p>ちなみに僕のプロジェクトではマルチバイト文字ではなく、ユニコード文字を使います。</p><h3 id=propertyの適用>Propertyの適用<a hidden class=anchor aria-hidden=true href=#propertyの適用>#</a></h3><blockquote><p><a href=https://cmake.org/cmake/help/latest/command/set_target_properties.html>https://cmake.org/cmake/help/latest/command/set_target_properties.html</a><a href=https://cmake.org/cmake/help/latest/manual/cmake-properties.7.html#target-properties>https://cmake.org/cmake/help/latest/manual/cmake-properties.7.html#target-properties</a></p></blockquote><p>ターゲットプロジェクトに属性（Property）を適用するためには、<code>set_target_properties</code>を使います。このコマンドが出来る前までは、<code>CXX_...</code>で始まる全域変数を使って、全てのプロジェクトに同一な属性をつけるしかなかったそうですが、バージョン3.0からは<code>..._target_...</code>みたいなコマンドで個別ターゲットを制御するようになったそうです。</p><p>とにかく、ターゲットの属性をつけるには<code>PROPERTIES</code>の後から属性を付けます。下のコードでは<code>CXX_STANDARD</code>という、Cppのバージョンを付けませんでしたが、それは後でコマンドラインまたは別個のプロジェクトCMakeLists.txtでつけるようになってます。もし何も指定されなかった場合にはC++17を自動に付けてあげます。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>set_target_properties</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span>
	<span class=s>PROPERTIES</span>
	<span class=s>LINKER_LANGUAGE</span> <span class=s>CXX</span>
	<span class=s>CXX_STANDARD_REQUIRED</span> <span class=s>ON</span>
	<span class=s>CXX_EXTENSIONS</span> <span class=s>ON</span>
	<span class=s>ARCHIVE_OUTPUT_DIRECTORY</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/lib/${CMAKE_BUILD_TYPE}&#34;</span>
	<span class=s>LIBRARY_OUTPUT_DIRECTORY</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/lib/${CMAKE_BUILD_TYPE}&#34;</span>
	<span class=s>RUNTIME_OUTPUT_DIRECTORY</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/bin/${CMAKE_BUILD_TYPE}&#34;</span>
<span class=p>)</span><span class=err>
</span></code></pre></div><h3 id=コンパイルオプション>コンパイルオプション<a hidden class=anchor aria-hidden=true href=#コンパイルオプション>#</a></h3><p>最後にプロジェクトをビルドする時のフラグを入れます。ただし、コンパイラごとにフラグに入れ方が違うため、<code>CMAKE_CXX_COMPILER_ID</code>全域変数を参照してコンパイラごとのフラグを入れる分岐を作ります。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>if</span> <span class=p>((</span>	<span class=c># MSVC or Clang-Cl (Simulated MSVC on Clang)
</span><span class=c></span>			<span class=o>${</span><span class=nv>CMAKE_CXX_COMPILER_ID</span><span class=o>}</span> <span class=s>STREQUAL</span> <span class=s2>&#34;Clang&#34;</span> 
			<span class=s>AND</span> <span class=s2>&#34;x${CMAKE_CXX_SIMULATE_ID}&#34;</span> <span class=s>STREQUAL</span> <span class=s2>&#34;xMSVC&#34;</span>
		<span class=p>)</span> 
		<span class=s>OR</span> <span class=o>${</span><span class=nv>CMAKE_CXX_COMPILER_ID</span><span class=o>}</span> <span class=s>STREQUAL</span> <span class=s2>&#34;MSVC&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=c># Clang-Cl, MSVC Flags
</span><span class=c></span><span class=nb>elseif</span><span class=p>(</span><span class=o>${</span><span class=nv>CMAKE_CXX_COMPILER_ID</span><span class=o>}</span> <span class=s>STREQUAL</span> <span class=s2>&#34;Clang&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=c># Clang Flags
</span><span class=c></span><span class=nb>else</span><span class=p>()</span><span class=err>
</span><span class=err></span>	<span class=nb>message</span><span class=p>(</span><span class=s>FATAL_ERROR</span> <span class=s2>&#34;This project only supports Clang/Clang-cl or MSVC compiler now.&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>endif</span><span class=p>()</span><span class=err>
</span></code></pre></div><p>ここで注意すべきところは、WindowsのVS（Visual Studio）でcmakeを使い、そしてVSから提供しているClangコンパイラではなく、自分のclangを取り入れてビルドさせる場合には<code>CMAKE_CXX_SIMULATE_ID</code>も検査する必要があります。（基本提供しているClangコンパイラでも起こりえる可能性はあります。）</p><p>なので、<code>Clang-Cl</code>を使ってる時には、</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>if</span> <span class=p>(</span><span class=o>${</span><span class=nv>CMAKE_CXX_COMPILER_ID</span><span class=o>}</span> <span class=s>STREQUAL</span> <span class=s2>&#34;Clang&#34;</span> <span class=s>AND</span> <span class=o>${</span><span class=nv>CMAKE_CXX_SIMULATE_ID</span><span class=o>}</span> <span class=s>STREQUAL</span> <span class=s2>&#34;MSVC&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=c># DO SOMETHING
</span><span class=c></span><span class=nb>endif</span><span class=p>()</span><span class=err>
</span></code></pre></div><p>で検査します。</p><p>コンパイラの検査が通ったら、<code>target_compile_options</code>を使い、フラグを入れます。3.0以前のバージョンでは<code>CXX_FLAGS</code>みたいなものを使ってたそうですが、あのやり方じゃ全体プロジェクトのフラグへ影響がありえます。なので今は<code>target_compile_options</code>を使ってターゲットごとのフラグを設定します。</p><p>ちょっと注目すべきところは、<code>generator expression</code>を使ってるとこです。<code>$&lt;$&lt;CONFIG:Debug>:${ComOpts_MsvcDebug}></code>またはDebugがReleaseにされているのが２つも存在しているのは、上で説明していた<code>&lt;CONFIG></code>の文字列を見て、ビルドする時にビルドモードによってフラグを洗濯的に入れるためです。</p><p>例えば、<code>Debug</code>モードの場合には２つめは無視され、１つ目は<code>ComOpts_MscvDebug</code>変数で指定されたフラグリストがターゲットに入ります。<code>Release</code>モードならば逆です。各フラグ変数はコード一番下で書いています。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>target_compile_options</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;$&lt;$&lt;CONFIG:Debug&gt;:${ComOpts_MsvcDebug}&gt;&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>target_compile_options</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;$&lt;$&lt;CONFIG:Release&gt;:${ComOpts_MsvcRelease}&gt;&#34;</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>ComOpts_MsvcCommon</span> 
	<span class=s>/GR-</span> <span class=s>/W4</span> <span class=s>/WX</span> <span class=s>/MP</span> 
	<span class=s>-Wno-error=unused-command-line-argument</span>
	<span class=s>-Wno-error=expansion-to-defined</span>
	<span class=s>-Wno-error=ignored-pragma-intrinsic</span>
<span class=p>)</span> <span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>ComOpts_MsvcDebug</span> <span class=s>/Od</span> <span class=o>${</span><span class=nv>ComOpts_MsvcCommon</span><span class=o>}</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>ComOpts_MsvcRelease</span> <span class=s>/O2</span> <span class=o>${</span><span class=nv>ComOpts_MsvcCommon</span><span class=o>}</span><span class=p>)</span><span class=err>
</span></code></pre></div><h1 id=プロジェクトごとのcmakeliststxt>プロジェクトごとのCMakeLists.txt<a hidden class=anchor aria-hidden=true href=#プロジェクトごとのcmakeliststxt>#</a></h1><p>各プロジェクトでは下だけを書くことで終わります。</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>cmake_minimum_required</span><span class=p>(</span><span class=s>VERSION</span> <span class=s>3.12</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>project</span><span class=p>(</span><span class=s>DyCommon</span> <span class=s>LANGUAGES</span> <span class=s>CXX</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>add_library</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>STATIC</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>dy_setup_build_settings</span><span class=p>()</span><span class=err>
</span></code></pre></div><p>または</p><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>cmake_minimum_required</span> <span class=p>(</span><span class=s>VERSION</span> <span class=s>3.12</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>project</span><span class=p>(</span><span class=s>TestD3D12</span> <span class=s>CXX</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=nb>add_executable</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>add_dependencies</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>DyCommon</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>target_link_libraries</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s>DyCommon</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>set_target_properties</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PROPERTIES</span> <span class=s>CXX_STANDARD</span> <span class=s>20</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=nb>dy_setup_build_settings</span><span class=p>()</span><span class=err>
</span></code></pre></div><p>ほとんどは<code>dy_setup_build_settings</code>マクロが設定してくれます。はい、おわり。</p><h1 id=反省点>反省点<a hidden class=anchor aria-hidden=true href=#反省点>#</a></h1><h3 id=unity-buildまたは類似unityの導入>Unity Buildまたは類似Unityの導入？<a hidden class=anchor aria-hidden=true href=#unity-buildまたは類似unityの導入>#</a></h3><p>今は<code>file(GLOB_RECURSE)</code>でソースファイルをまとめてターゲットにバインディングしているようにしてますが、やるなら<code>file</code>コマンドをより活用して一時のUnityビルドファイルを作り、そこにリストをインクルードするコードをCmake側から書いてUnityファイルだけビルド通るようにすることも良さそうじゃないかな～と思いました。</p><p>まず、<code>file(GLOB)</code>自体が設定時にコマンド実行が行うため、設定後で新しいファイルを追加しようとしたら再度設定をし直さなければならないです。生産性も下がりそうだし、ビルドするまでの時間もかかりそうだから、やるならUnityビルドしかけたりする方が良いんじゃね…？とふと思いつきました。</p><p>後で試してみて、上手く出来たらコード改良して切り換えたいです。</p><h3 id=d3d12ライブラリ導入の制御が足りない>D3D12ライブラリ導入の制御が足りない<a hidden class=anchor aria-hidden=true href=#d3d12ライブラリ導入の制御が足りない>#</a></h3><p>現在のコードでは、WindowsならD3D12も自動に入れるようにしています。ですが、D3D12のライブラリは基本的にはWindows10以上のみ対応しているらしく、以前のWindowsOSでは当然ビルドエラーが出ちゃうか、意図してない挙動になれると思います。</p><p>なんで、解決策として<code>option</code>コマンドなどでD3D12を入れるかないかを設定するようにし、OSのプラットフォームを詳しく区別させてWin10ではなければD3D12のインポートを解除するようにしつつ、フラグの<code>true/false</code>によって洗濯的にライブラリを入れるようにコードを修正すれば良いんじゃないかなと思いますね。</p><h3 id=add_subdirectoryではなくimportで出来るのでは>add_subdirectoryではなく、IMPORTで出来るのでは？<a hidden class=anchor aria-hidden=true href=#add_subdirectoryではなくimportで出来るのでは>#</a></h3><blockquote><p><a href="https://www.youtube.com/watch?v=y7ndUhdQuU8">https://www.youtube.com/watch?v=y7ndUhdQuU8</a><a href="https://www.youtube.com/watch?v=y9kSr5enrSk">https://www.youtube.com/watch?v=y9kSr5enrSk</a></p></blockquote><p><code>add_subdirectory</code>ではなく、<code>IMPORT</code>でプロジェクトを関連させたりビルドさせたりすることが出来るらしいけど、詳しくは存じないです。単純に勘違いしたかもしれませんね…</p><h3 id=警告メッセージをむりやり抑えてしまった>警告メッセージをむりやり抑えてしまった<a hidden class=anchor aria-hidden=true href=#警告メッセージをむりやり抑えてしまった>#</a></h3><p>Cmake＋Clang-Clでは<code>/MP</code>（マルチプロセッサで並列ビルドを行う）フラグが通じないみたいです。<code>/W4 /WX</code>まで付けたせいでエラーが出まくって、一応<code>-Wno</code>フラグでなんとか警告として扱うように抑えましたが、ちょっと気に食わないですね。</p><h1 id=全文>全文<a hidden class=anchor aria-hidden=true href=#全文>#</a></h1><div class=highlight><pre class=chroma><code class=language-cmake data-lang=cmake><span class=nb>cmake_minimum_required</span><span class=p>(</span><span class=s>VERSION</span> <span class=s>3.12</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>project</span><span class=p>(</span><span class=s>Dy</span> <span class=s>CXX</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># @brief Find platform key string if found.
</span><span class=c>#	Returned `OPlatform` key string is one of below list when found.
</span><span class=c>#	* WIN : Windows
</span><span class=c>#	* LNX : Linux
</span><span class=c>#	* MAC : MacOS (Darwin)
</span><span class=c>#	If not found, key string will be `-NOTFOUND`.
</span><span class=c>#
</span><span class=c># @param IVerbose verbosity flag. input value is true / false.
</span><span class=c># @return_var OPlatform 
</span><span class=c></span><span class=nb>function</span><span class=p>(</span><span class=s>_find_platform</span> <span class=s>IVerbose</span> <span class=s>OPlatform</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>if</span> <span class=p>(</span><span class=s>IVerbose</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>CMAKE_HOST_SYSTEM_NAME</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=nb>if</span> <span class=p>(</span><span class=s2>&#34;${CMAKE_HOST_SYSTEM_NAME}&#34;</span> <span class=s>STREQUAL</span> <span class=s2>&#34;Windows&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>if</span> <span class=p>(</span><span class=s>IVerbose</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>message</span><span class=p>(</span><span class=s>STATUS</span> <span class=s2>&#34;Found Windows.&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OPlatform</span><span class=o>}</span> <span class=s2>&#34;WIN&#34;</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>elseif</span><span class=p>(</span><span class=s2>&#34;${CMAKE_HOST_SYSTEM_NAME}&#34;</span> <span class=s>STREQUAL</span> <span class=s2>&#34;Linux&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>if</span> <span class=p>(</span><span class=s>IVerbose</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>message</span><span class=p>(</span><span class=s>STATUS</span> <span class=s2>&#34;Found Linux.&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OPlatform</span><span class=o>}</span> <span class=s2>&#34;LNX&#34;</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>elseif</span><span class=p>(</span><span class=s2>&#34;${CMAKE_HOST_SYSTEM_NAME}&#34;</span> <span class=s>STREQUAL</span> <span class=s2>&#34;Darwin&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>if</span> <span class=p>(</span><span class=s>IVerbose</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>message</span><span class=p>(</span><span class=s>STATUS</span> <span class=s2>&#34;Found MacOS.&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OPlatform</span><span class=o>}</span> <span class=s2>&#34;MAC&#34;</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span><span class=nb>endfunction</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># @brief Check given platform is supported with `IPlatformKey` variable.
</span><span class=c>#	Returned `OIsSupported` key have true or false whether given platform is supported or not.
</span><span class=c>#	* true : Detected platform is suppported.
</span><span class=c>#	* false : Detected platform is not supported yet.
</span><span class=c># 
</span><span class=c># @param IPlatformKey Get platform key by using _find_platform function.
</span><span class=c># @return_var OIsSupported
</span><span class=c></span><span class=nb>function</span><span class=p>(</span><span class=s>_check_supported_platform</span> <span class=s>IPlatformKey</span> <span class=s>OIsSupported</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>if</span> <span class=p>(</span><span class=s2>&#34;${IPlatformKey}&#34;</span> <span class=s>STREQUAL</span> <span class=s2>&#34;WIN&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OIsSupported</span><span class=o>}</span> <span class=s>true</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>return</span><span class=p>()</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=c># If there is no matched key, just return with false.
</span><span class=c></span>	<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OISSupported</span><span class=o>}</span> <span class=s>false</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>endfunction</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># @brief Check if platform is windows.
</span><span class=c>#
</span><span class=c># @return_var OBool
</span><span class=c></span><span class=nb>function</span><span class=p>(</span><span class=s>_is_windows</span> <span class=s>OBool</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>_find_platform</span><span class=p>(</span><span class=s>false</span> <span class=s>_in_key</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>if</span> <span class=p>(</span><span class=s2>&#34;${_in_key}&#34;</span> <span class=s>STREQUAL</span> <span class=s2>&#34;WIN&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OBool</span><span class=o>}</span> <span class=s>true</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>return</span><span class=p>()</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=c># If not matched, return false.
</span><span class=c></span>	<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OBool</span><span class=o>}</span> <span class=s>false</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>endfunction</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># @brief Find Windows SDK pathes and properties information.
</span><span class=c>#
</span><span class=c># @return_var ODirs All found SDK path list.
</span><span class=c># @return_var OBuildVers NOt used
</span><span class=c># @return_var ONames Not used
</span><span class=c># @return_var ODir Latest SDK path. 
</span><span class=c># @return_var OLibDir Latest SDK include file path.
</span><span class=c># @return_var OIncDir Latest SDK library file path.
</span><span class=c></span><span class=nb>function</span><span class=p>(</span><span class=s>_find_winsdk</span> <span class=s>IVerbose</span> <span class=s>ODirs</span> <span class=s>OBuildVers</span> <span class=s>ONames</span> <span class=s>ODir</span> <span class=s>OLibDir</span> <span class=s>OIncDir</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>_is_windows</span><span class=p>(</span><span class=s>_in_flag</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>if</span> <span class=p>(</span><span class=s>_in_flag</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>include</span><span class=p>(</span><span class=s>FindWindowsSDK</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=c>#
</span><span class=c></span>		<span class=nb>if</span> <span class=p>(</span><span class=s>NOT</span> <span class=s>WINDOWSSDK_FOUND</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>message</span><span class=p>(</span><span class=s>FATAL_ERROR</span> <span class=s2>&#34;Proper Windows SDK is not found.&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>return</span><span class=p>()</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=c>#
</span><span class=c></span>		<span class=nb>if</span> <span class=p>(</span><span class=s>IVerbose</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WINDOWSSDK_DIRS</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WINDOWSSDK_FOUND_PREFERENCE</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WINDOWSSDK_LATEST_NAME</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WINDOWSSDK_LATEST_DIR</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=c># Update variables.
</span><span class=c></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>ODirs</span><span class=o>}</span> <span class=o>${</span><span class=nv>WINDOWSSDK_DIRS</span><span class=o>}</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>ODir</span><span class=o>}</span> <span class=o>${</span><span class=nv>WINDOWSSDK_LATEST_DIR</span><span class=o>}</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=s>_in_ODir</span> <span class=o>${</span><span class=nv>WINDOWSSDK_LATEST_DIR</span><span class=o>}</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>get_windowssdk_library_dirs</span><span class=p>(</span><span class=o>${</span><span class=nv>_in_ODir</span><span class=o>}</span> <span class=s>_in_OLibDir</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>get_windowssdk_include_dirs</span><span class=p>(</span><span class=o>${</span><span class=nv>_in_ODir</span><span class=o>}</span> <span class=s>_in_OIncDir</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=nb>windowssdk_name_lookup</span><span class=p>(</span><span class=o>${</span><span class=nv>_in_ODir</span><span class=o>}</span> <span class=s>_in_ONames</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>windowssdk_build_lookup</span><span class=p>(</span><span class=o>${</span><span class=nv>_in_ODir</span><span class=o>}</span> <span class=s>_in_OBuildVers</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OBuildVers</span><span class=o>}</span> <span class=o>${</span><span class=nv>_in_OBuildVers</span><span class=o>}</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>ONames</span><span class=o>}</span> <span class=o>${</span><span class=nv>_in_ONames</span><span class=o>}</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OLibDir</span><span class=o>}</span> <span class=o>${</span><span class=nv>_in_OLibDir</span><span class=o>}</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>OIncDir</span><span class=o>}</span> <span class=o>${</span><span class=nv>_in_OIncDir</span><span class=o>}</span> <span class=s>PARENT_SCOPE</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span><span class=nb>endfunction</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># @macro dy_setup_build_settings
</span><span class=c>#
</span><span class=c># @brief Set up default build settings.
</span><span class=c>#	Every project that needs to be built should be call this macro.
</span><span class=c></span><span class=nb>macro</span><span class=p>(</span><span class=s>dy_setup_build_settings</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>message</span><span class=p>(</span><span class=s>STATUS</span> <span class=s2>&#34;${PROJECT_NAME} is built with ${CMAKE_BUILD_TYPE} mode.&#34;</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=c># If there are source files in /Src, add source files (.cc) but except for prefix `_` files.
</span><span class=c></span>	<span class=nb>set</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span><span class=s>_InGetSrcs</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>file</span><span class=p>(</span>
		<span class=s>GLOB_RECURSE</span> <span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span><span class=s>_InGetSrcs</span>
		<span class=s>RELATIVE</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/Src&#34;</span>
		<span class=s>CONFIGURE_DEPENDS</span> <span class=s>*.cc</span>
	<span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=c># Check if there are `Inc` and `Inl` directory in ${CMAKE_CURRENT_SOURCE_DIR}.
</span><span class=c></span>	<span class=nb>if</span> <span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span><span class=s>_InGetSrcs</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=c># If exist, add target_include_directories as PUBLIC.
</span><span class=c></span>		<span class=nb>if</span> <span class=p>(</span><span class=s>EXISTS</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/Inc&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>target_include_directories</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s>Inc</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span>		<span class=nb>if</span> <span class=p>(</span><span class=s>EXISTS</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/Inl&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>target_include_directories</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s>Inl</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span>	<span class=nb>else</span><span class=p>()</span><span class=err>
</span><span class=err></span>		<span class=c># If exist, add target_include_directories as INTERFACE.
</span><span class=c></span>		<span class=nb>if</span> <span class=p>(</span><span class=s>EXISTS</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/Inc&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>target_include_directories</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>INTERFACE</span> <span class=s>Inc</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span>		<span class=nb>if</span> <span class=p>(</span><span class=s>EXISTS</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/Inl&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>target_include_directories</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>INTERFACE</span> <span class=s>Inl</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=c># ...To match a literal - using brackets, 
</span><span class=c></span>	<span class=c># make it the first or the last character e.g. [+*/-] matches basic mathematical operators.
</span><span class=c></span>	<span class=nb>foreach</span><span class=p>(</span><span class=s>SrcItem</span> <span class=o>${</span><span class=nv>${PROJECT_NAME</span><span class=o>}</span><span class=s>_InGetSrcs}</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>if</span> <span class=p>(</span><span class=s2>&#34;Src/${SrcItem}&#34;</span> <span class=s>MATCHES</span> <span class=s2>&#34;/_+[a-zA-Z0-9_ -]*.cc$&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>continue</span><span class=p>()</span><span class=err>
</span><span class=err></span>		<span class=nb>else</span><span class=p>()</span><span class=err>
</span><span class=err></span>			<span class=nb>target_sources</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PRIVATE</span> <span class=s2>&#34;Src/${SrcItem}&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span>	<span class=nb>endforeach</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=c># Set CXX Properties
</span><span class=c></span>	<span class=nb>get_target_property</span><span class=p>(</span><span class=s>CxxStdVersion</span> <span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>CXX_STANDARD</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>if</span> <span class=p>(</span><span class=s>CxxStdVersion</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>message</span><span class=p>(</span><span class=s>STATUS</span> <span class=s2>&#34;${PROJECT_NAME} is built with C++${CxxStdVersion}&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>else</span> <span class=p>()</span><span class=err>
</span><span class=err></span>		<span class=c># -NOTFOUND 
</span><span class=c></span>		<span class=nb>set</span><span class=p>(</span><span class=s>CxxStdVersion</span> <span class=s>17</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>set_property</span><span class=p>(</span><span class=s>TARGET</span> <span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PROPERTY</span> <span class=s>CXX_STANDARD</span> <span class=s>17</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>target_compile_definitions</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s>CPP_DyCommon_VER_17</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=c># Set properties.
</span><span class=c></span>	<span class=nb>set_target_properties</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span>
		<span class=s>PROPERTIES</span>
		<span class=s>LINKER_LANGUAGE</span> <span class=s>CXX</span>
		<span class=s>CXX_STANDARD_REQUIRED</span> <span class=s>ON</span>
		<span class=s>CXX_EXTENSIONS</span> <span class=s>ON</span>
		<span class=s>ARCHIVE_OUTPUT_DIRECTORY</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/lib/${CMAKE_BUILD_TYPE}&#34;</span>
		<span class=s>LIBRARY_OUTPUT_DIRECTORY</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/lib/${CMAKE_BUILD_TYPE}&#34;</span>
		<span class=s>RUNTIME_OUTPUT_DIRECTORY</span> <span class=s2>&#34;${CMAKE_CURRENT_SOURCE_DIR}/bin/${CMAKE_BUILD_TYPE}&#34;</span>
	<span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=c># Add compile option flags.
</span><span class=c></span>	<span class=nb>if</span> <span class=p>((</span>	<span class=c># MSVC or Clang-Cl (Simulated MSVC on Clang)
</span><span class=c></span>			<span class=o>${</span><span class=nv>CMAKE_CXX_COMPILER_ID</span><span class=o>}</span> <span class=s>STREQUAL</span> <span class=s2>&#34;Clang&#34;</span> 
			<span class=s>AND</span> <span class=s2>&#34;x${CMAKE_CXX_SIMULATE_ID}&#34;</span> <span class=s>STREQUAL</span> <span class=s2>&#34;xMSVC&#34;</span>
		<span class=p>)</span> 
		<span class=s>OR</span> <span class=o>${</span><span class=nv>CMAKE_CXX_COMPILER_ID</span><span class=o>}</span> <span class=s>STREQUAL</span> <span class=s2>&#34;MSVC&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=c># CXX Flags.
</span><span class=c></span>		<span class=nb>if</span> <span class=p>(</span><span class=o>${</span><span class=nv>CxxStdVersion</span><span class=o>}</span> <span class=s>EQUAL</span> <span class=s2>&#34;20&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>			<span class=nb>target_compile_options</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;/std:c++latest&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>else</span><span class=p>()</span><span class=err>
</span><span class=err></span>			<span class=nb>target_compile_options</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;/std:c++${CxxStdVersion}&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=c># Additional Flags.
</span><span class=c></span>		<span class=c># https://cmake.org/cmake/help/latest/manual/cmake-generator-expressions.7.html
</span><span class=c></span>		<span class=nb>target_compile_options</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;$&lt;$&lt;CONFIG:Debug&gt;:${ComOpts_MsvcDebug}&gt;&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>target_compile_options</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;$&lt;$&lt;CONFIG:Release&gt;:${ComOpts_MsvcRelease}&gt;&#34;</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=nb>elseif</span><span class=p>(</span><span class=o>${</span><span class=nv>CMAKE_CXX_COMPILER_ID</span><span class=o>}</span> <span class=s>STREQUAL</span> <span class=s2>&#34;Clang&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=c># CXX Flags.
</span><span class=c></span>		<span class=nb>target_compile_options</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;-std=c++${CxxStdVersion}&#34;</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=c># Additional Flags.
</span><span class=c></span>		<span class=nb>target_compile_options</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;$&lt;$&lt;CONFIG:Debug&gt;:${ComOpts_ClangDebug}&gt;&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>target_compile_options</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;$&lt;$&lt;CONFIG:Release&gt;:${ComOpts_ClangRelease}&gt;&#34;</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=nb>else</span><span class=p>()</span><span class=err>
</span><span class=err></span>		<span class=nb>message</span><span class=p>(</span><span class=s>FATAL_ERROR</span> <span class=s2>&#34;This project only supports Clang/Clang-cl or MSVC compiler now.&#34;</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span>	<span class=c># If windows, let project add WIN32 and D3D12 libraries.
</span><span class=c></span>	<span class=nb>_is_windows</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span><span class=s>IsWin</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>if</span> <span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span><span class=s>IsWin</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=c># It seems it have not to be inserted into all project when WIN.
</span><span class=c></span>		<span class=c># target_include_directories(${PROJECT_NAME} PRIVATE ${WinInc})
</span><span class=c></span>		<span class=nb>target_link_directories</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PRIVATE</span> <span class=o>${</span><span class=nv>WinLib</span><span class=o>}</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span>		<span class=nb>target_compile_definitions</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> 
		<span class=s>PRIVATE</span> 
			<span class=s2>&#34;UNICODE&#34;</span> 
			<span class=s2>&#34;_UNICODE&#34;</span>
			<span class=s2>&#34;_CRT_SECURE_NO_WARNINGS&#34;</span>
		<span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>target_link_libraries</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> 
		<span class=s>PRIVATE</span> 
			<span class=s2>&#34;d3d12.lib&#34;</span> 
			<span class=s2>&#34;d3dcompiler.lib&#34;</span> 
			<span class=s2>&#34;dxgi.lib&#34;</span>
		<span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span><span class=nb>endmacro</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c># -----------------------------------------------------------------------------
</span><span class=c># 
</span><span class=c># MAIN ROUTINES
</span><span class=c>#
</span><span class=c># -----------------------------------------------------------------------------
</span><span class=c></span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>CMAKE_VERBOSE_MAKEFILE</span> <span class=s>true</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>CMAKE_MODULE_PATH</span> <span class=s2>&#34;${CMAKE_SOURCE_DIR}/Module&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>include</span><span class=p>(</span><span class=s>CMakePrintHelpers</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>include</span><span class=p>(</span><span class=s>cotire</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=nb>_find_platform</span><span class=p>(</span><span class=s>VERBOSE,</span> <span class=s>PlatformKey</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>_check_supported_platform</span><span class=p>(</span><span class=s>PlatformKey,</span> <span class=s>IsSupportedPlatform</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>if</span> <span class=p>(</span><span class=s>IsSupportedPlatform</span> <span class=s>EQUAL</span> <span class=s>false</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>message</span><span class=p>(</span><span class=s>FATAL_ERROR</span> <span class=s2>&#34;${PlatformKey} is not supported platform.&#34;</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=nb>_is_windows</span><span class=p>(</span><span class=s>_out_iswindows</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>if</span> <span class=p>(</span><span class=s>_out_iswindows</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>_find_winsdk</span><span class=p>(</span><span class=s>VERBOSE</span> <span class=s>WinDirs</span> <span class=s>WinBuildVers</span> <span class=s>WinName</span> <span class=s>WinDir</span> <span class=s>WinLib</span> <span class=s>WinInc</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>if</span> <span class=p>(</span><span class=s>VERBOSE</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WinDirs</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WinDir</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WinLib</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WinInc</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WinName</span><span class=p>)</span><span class=err>
</span><span class=err></span>		<span class=nb>cmake_print_variables</span><span class=p>(</span><span class=s>WinBuildVers</span><span class=p>)</span><span class=err>
</span><span class=err></span>	<span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err></span><span class=nb>endif</span><span class=p>()</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c>#
</span><span class=c># Compiler Flags
</span><span class=c>#
</span><span class=c></span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>ComOpts_MsvcCommon</span> 
	<span class=s>/GR-</span> <span class=s>/W4</span> <span class=s>/WX</span> <span class=s>/MP</span> 
	<span class=s>-Wno-error=unused-command-line-argument</span>
	<span class=s>-Wno-error=expansion-to-defined</span>
	<span class=s>-Wno-error=ignored-pragma-intrinsic</span>
<span class=p>)</span> <span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>ComOpts_MsvcDebug</span> <span class=s>/Od</span> <span class=o>${</span><span class=nv>ComOpts_MsvcCommon</span><span class=o>}</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>ComOpts_MsvcRelease</span> <span class=s>/O2</span> <span class=o>${</span><span class=nv>ComOpts_MsvcCommon</span><span class=o>}</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>ComOpts_ClangCommon</span> <span class=s>-Wall</span> <span class=s>-Werror</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>ComOpts_ClangDebug</span> <span class=o>${</span><span class=nv>ComOpts_ClangCommon</span><span class=o>}</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>ComOpts_ClangRelease</span> <span class=s>-O3</span> <span class=o>${</span><span class=nv>ComOpts_ClangCommon</span><span class=o>}</span><span class=p>)</span><span class=err>
</span><span class=err>
</span><span class=err></span><span class=c>#
</span><span class=c># Subdirectory (Need to be changed with IMPORT module.)
</span><span class=c>#
</span><span class=c></span><span class=err>
</span><span class=err></span><span class=nb>add_subdirectory</span><span class=p>(</span><span class=s>Engine</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>add_subdirectory</span><span class=p>(</span><span class=s>TestPrj</span><span class=p>)</span><span class=err>
</span><span class=err></span><span class=nb>add_subdirectory</span><span class=p>(</span><span class=s>ThirdParty</span><span class=p>)</span><span class=err>
</span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://liliilli.github.io/tags/untagged/>untagged</a></li></ul><nav class=paginav><a class=prev href=https://liliilli.github.io/posts/matrix_name/><span class=title>« Prev Page</span><br><span>行列変数のネーミングについて</span></a>
<a class=next href=https://liliilli.github.io/posts/cmake_memo/><span class=title>Next Page »</span><br><span>CMakeのメモまとめ</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 自分でやるDyのCMakeListsファイル説明 on twitter" href="https://twitter.com/intent/tweet/?text=%e8%87%aa%e5%88%86%e3%81%a7%e3%82%84%e3%82%8bDy%e3%81%aeCMakeLists%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e8%aa%ac%e6%98%8e&url=https%3a%2f%2fliliilli.github.io%2fposts%2fdy_cmake%2f&hashtags=untagged"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 自分でやるDyのCMakeListsファイル説明 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fliliilli.github.io%2fposts%2fdy_cmake%2f&title=%e8%87%aa%e5%88%86%e3%81%a7%e3%82%84%e3%82%8bDy%e3%81%aeCMakeLists%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e8%aa%ac%e6%98%8e&summary=%e8%87%aa%e5%88%86%e3%81%a7%e3%82%84%e3%82%8bDy%e3%81%aeCMakeLists%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e8%aa%ac%e6%98%8e&source=https%3a%2f%2fliliilli.github.io%2fposts%2fdy_cmake%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 自分でやるDyのCMakeListsファイル説明 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fliliilli.github.io%2fposts%2fdy_cmake%2f&title=%e8%87%aa%e5%88%86%e3%81%a7%e3%82%84%e3%82%8bDy%e3%81%aeCMakeLists%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e8%aa%ac%e6%98%8e"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 自分でやるDyのCMakeListsファイル説明 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fliliilli.github.io%2fposts%2fdy_cmake%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 自分でやるDyのCMakeListsファイル説明 on whatsapp" href="https://api.whatsapp.com/send?text=%e8%87%aa%e5%88%86%e3%81%a7%e3%82%84%e3%82%8bDy%e3%81%aeCMakeLists%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e8%aa%ac%e6%98%8e%20-%20https%3a%2f%2fliliilli.github.io%2fposts%2fdy_cmake%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 自分でやるDyのCMakeListsファイル説明 on telegram" href="https://telegram.me/share/url?text=%e8%87%aa%e5%88%86%e3%81%a7%e3%82%84%e3%82%8bDy%e3%81%aeCMakeLists%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e8%aa%ac%e6%98%8e&url=https%3a%2f%2fliliilli.github.io%2fposts%2fdy_cmake%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>Copyright © 2008–2019, Steve Francia and the Hugo Authors; all rights reserved.</span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>